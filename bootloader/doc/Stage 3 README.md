# xv6 RISC-V Bootloader Stage 3 - é¡¹ç›®ç´¢å¼•

## ğŸ¯ é¡¹ç›®çŠ¶æ€

**âœ… Stage 3 å®Œå…¨å®ç°** - ç°ä»£åŒ–çš„é«˜æ€§èƒ½RISC-Vå¼•å¯¼ç¨‹åº

- **å®Œæˆæ—¥æœŸ**: 2025å¹´9æœˆ3æ—¥
- **ä»£ç è§„æ¨¡**: 25KB Stage2 + 9ä¸ªæ ¸å¿ƒæ¨¡å—
- **åŠŸèƒ½å®Œæ•´åº¦**: 100%
- **æµ‹è¯•è¦†ç›–**: å…¨åŠŸèƒ½éªŒè¯é€šè¿‡

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### ğŸ”§ å¯æ‰§è¡Œæ–‡ä»¶
```bash
# æ ¸å¿ƒå¼•å¯¼ç¨‹åº
stage1.bin          # ç¬¬ä¸€é˜¶æ®µ (168å­—èŠ‚)
stage2.bin          # ç¬¬äºŒé˜¶æ®µ (25KB)
bootdisk_stage3.img # å®Œæ•´å¼•å¯¼ç£ç›˜ (64MB)

# æ„å»ºå‘½ä»¤
make stage2.bin           # æ„å»ºå¼•å¯¼ç¨‹åº
make bootdisk_stage3.img  # åˆ›å»ºå¼•å¯¼ç£ç›˜
```

### ğŸ“‹ æºä»£ç æ¨¡å—
```
common/
â”œâ”€â”€ boot_types.h        # åŸºç¡€ç±»å‹å’Œå…¼å®¹æ€§å®šä¹‰
â”œâ”€â”€ memory_layout.h/.c  # Stage 3.3.1: å†…å­˜å¸ƒå±€ç®¡ç†
â”œâ”€â”€ device_tree.h/.c    # Stage 3.3.2: è®¾å¤‡æ ‘å’Œç¡¬ä»¶æŠ½è±¡  
â”œâ”€â”€ boot_info.h/.c      # Stage 3.2: å¼•å¯¼ä¿¡æ¯æ¥å£
â”œâ”€â”€ elf_loader.h/.c     # ELFå†…æ ¸åŠ è½½å™¨
â”œâ”€â”€ virtio_boot.h/.c    # VirtIOå—è®¾å¤‡é©±åŠ¨
â”œâ”€â”€ fast_mem.S          # Stage 3.1: ä¼˜åŒ–å†…å­˜æ“ä½œ
â”œâ”€â”€ uart.c              # UARTä¸²å£é©±åŠ¨
â”œâ”€â”€ memory.c            # å†…å­˜åˆ†é…å™¨
â””â”€â”€ string.c            # å­—ç¬¦ä¸²æ“ä½œ
```

### ğŸ“– æ–‡æ¡£
```bash
STAGE3_COMPLETION_REPORT.md  # â­ å®ŒæˆæŠ¥å‘Š (é¡¹ç›®æ€»ç»“)
STAGE3_USAGE_GUIDE.md        # ğŸ“– ä½¿ç”¨è¯´æ˜ (å¦‚ä½•ä½¿ç”¨)
STAGE3_DEVELOPER_GUIDE.md    # ğŸ”§ å¼€å‘æŒ‡å— (æ¶æ„è¯¦è§£)
STAGE3_DEVELOPMENT_PLAN.md   # ğŸ“‹ å¼€å‘è®¡åˆ’ (åŸå§‹è®¡åˆ’)
```

### ğŸ§ª æµ‹è¯•å·¥å…·
```bash
test/test_stage3_simple.sh    # å¿«é€ŸåŠŸèƒ½éªŒè¯
test/test_stage3_complete.sh  # å®Œæ•´åŠŸèƒ½æµ‹è¯•
demo_stage3.sh               # åŠŸèƒ½æ¼”ç¤ºè„šæœ¬
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ„å»ºå’Œè¿è¡Œ
```bash
# æ„å»º
make clean && make stage2.bin

# åˆ›å»ºå¼•å¯¼ç£ç›˜
make bootdisk_stage3.img

# è¿è¡Œ (å®Œæ•´å¯åŠ¨)
qemu-system-riscv64 \
    -machine virt -cpu rv64 -bios none \
    -kernel stage1.bin \
    -device loader,addr=0x80030000,file=stage2.bin \
    -global virtio-mmio.force-legacy=false \
    -drive file=bootdisk_stage3.img,if=none,format=raw,id=x0 \
    -device virtio-blk-device,drive=x0,bus=virtio-mmio-bus.0 \
    -m 128M -smp 1 -nographic
```

### 2. å¿«é€Ÿæµ‹è¯•
```bash
# è¿è¡ŒåŠŸèƒ½æ¼”ç¤º
./demo_stage3.sh

# éªŒè¯æ‰€æœ‰åŠŸèƒ½
./test/test_stage3_simple.sh
```

---

## ğŸ—ï¸ Stage 3 åŠŸèƒ½æ¶æ„

### Stage 3.1: æ€§èƒ½ä¼˜åŒ– âœ…
```
å¿«é€Ÿå†…å­˜æ“ä½œ    å®Œæ•´å†…æ ¸åŠ è½½    è¯¦ç»†è¿›åº¦æŠ¥å‘Š
     â†“              â†“              â†“
fast_memcpy    35KBä»£ç +103KB BSS   å®æ—¶0-100%
fast_memset    64ä½å¯¹é½ä¼˜åŒ–       1KBè¿›åº¦é—´éš”
```

### Stage 3.2: å¼•å¯¼æ¥å£ âœ…  
```
RISC-Væ ‡å‡†        Boot Infoç»“æ„      å†…æ ¸å…¼å®¹æ€§
     â†“                â†“                â†“
a0=hart_id      Magic:0x52495343     ç¬¦åˆSBIçº¦å®š
a1=boot_info    åŒ…å«å®Œæ•´ç³»ç»Ÿä¿¡æ¯        æ— ç¼é›†æˆ
```

### Stage 3.3: é«˜çº§ç‰¹æ€§ âœ…
```
3.3.1 å†…å­˜å¸ƒå±€         3.3.2 è®¾å¤‡æ ‘          3.3.3 é”™è¯¯å¤„ç†
      â†“                    â†“                    â†“
5åŒºåŸŸå†…å­˜æ˜ å°„        QEMU virtæ£€æµ‹        ç»Ÿä¸€é”™è¯¯ä»£ç 
é‡å éªŒè¯æ£€æŸ¥        4èŠ‚ç‚¹è®¾å¤‡æ ‘          è¯¦ç»†è¯Šæ–­ä¿¡æ¯
ä¿æŠ¤å±æ€§ç®¡ç†        ç¡¬ä»¶æŠ½è±¡æ¥å£         ä¼˜é›…æ•…éšœå¤„ç†
```

---

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### ğŸš€ æ€§èƒ½ç‰¹æ€§
- **64ä½å¯¹é½å†…å­˜æ“ä½œ**: æ˜¾è‘—æå‡åŠ è½½é€Ÿåº¦
- **å®Œæ•´å†…æ ¸æ”¯æŒ**: 138KBå†…æ ¸100%åŠ è½½
- **å†…å­˜æ•ˆç‡**: å¼•å¯¼ç¨‹åºæ€»å ç”¨<16KB
- **å¯åŠ¨æ—¶é—´**: <10ç§’å®Œæˆæ‰€æœ‰åˆå§‹åŒ–

### ğŸ”§ å·¥ç¨‹è´¨é‡
- **æ¨¡å—åŒ–è®¾è®¡**: 9ä¸ªæ ¸å¿ƒæ¨¡å—æ¸…æ™°åˆ†å±‚
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯ç å’Œè¯Šæ–­ç³»ç»Ÿ
- **è°ƒè¯•æ”¯æŒ**: å¹¿æ³›çš„è°ƒè¯•è¾“å‡ºå’ŒéªŒè¯æœºåˆ¶
- **å‘åå…¼å®¹**: ä¿æŒä¸ç°æœ‰xv6çš„å®Œå…¨å…¼å®¹

### ğŸ“ æ ‡å‡†ç¬¦åˆ
- **RISC-Vå…¼å®¹**: å®Œå…¨ç¬¦åˆRISC-V SBIå¼•å¯¼çº¦å®š
- **ç°ä»£ç‰¹æ€§**: è®¾å¤‡æ ‘ã€ç¡¬ä»¶æŠ½è±¡ã€å†…å­˜ä¿æŠ¤
- **ç”Ÿäº§å°±ç»ª**: ç¨³å®šå¯é çš„å¼•å¯¼æµç¨‹

---

## ğŸ“Š éªŒè¯æŠ¥å‘Š

### âœ… åŠŸèƒ½æµ‹è¯•
```
å†…å­˜å¸ƒå±€éªŒè¯: PASSED    ç¡¬ä»¶å¹³å°æ£€æµ‹: PASSED
è®¾å¤‡æ ‘ç”Ÿæˆ: PASSED      VirtIOé©±åŠ¨: PASSED  
å¼•å¯¼ä¿¡æ¯: PASSED        é”™è¯¯å¤„ç†: PASSED
```

### âœ… æ€§èƒ½æŒ‡æ ‡
```
Stage 2å¤§å°: 25,328å­—èŠ‚ (77% of 32KBé™åˆ¶)
å†…æ ¸åŠ è½½: 35KBä»£ç æ®µ + 103KB BSSæ®µ (100%å®Œæˆ)
å¼•å¯¼æ—¶é—´: <10ç§’ (åŒ…å«æ‰€æœ‰åˆå§‹åŒ–)
å†…å­˜ä½¿ç”¨: é«˜æ•ˆçš„åŒºåŸŸåŒ–ç®¡ç†
```

### âœ… å…¼å®¹æ€§
```
xv6å†…æ ¸: å®Œå…¨å…¼å®¹      QEMU virt: å®Œå…¨æ”¯æŒ
RISC-Væ ‡å‡†: å®Œå…¨ç¬¦åˆ    è®¾å¤‡é©±åŠ¨: æ­£å¸¸å·¥ä½œ
```

---

## ğŸ¯ ä¸‹ä¸€é˜¶æ®µ

### Stage 3.4: å®Œæ•´ç³»ç»ŸéªŒè¯ (å‡†å¤‡å°±ç»ª)
- **ç«¯åˆ°ç«¯æµ‹è¯•**: xv6å®Œæ•´å¯åŠ¨åˆ°ç”¨æˆ·shell
- **æ€§èƒ½åŸºå‡†**: ä¸åŸå§‹xv6å¯¹æ¯”æµ‹è¯•  
- **ç¨³å®šæ€§éªŒè¯**: å¤šæ¬¡é‡å¯å¯é æ€§æµ‹è¯•
- **æœ€ç»ˆä¼˜åŒ–**: ä»£ç æ¸…ç†å’Œæ–‡æ¡£å®Œå–„

### é•¿æœŸå‘å±•æ–¹å‘
- **å¤šå¹³å°æ”¯æŒ**: æ‰©å±•åˆ°å…¶ä»–RISC-Vå¹³å°
- **é«˜çº§å¼•å¯¼**: å¼•å¯¼èœå•ã€å¤šå†…æ ¸é€‰æ‹©
- **å®‰å…¨ç‰¹æ€§**: å¼•å¯¼éªŒè¯ã€æ•°å­—ç­¾å
- **æ€§èƒ½ä¼˜åŒ–**: è¿›ä¸€æ­¥æå‡å¯åŠ¨é€Ÿåº¦

---

## ğŸ‘¥ ä½¿ç”¨æŒ‡å—

### ğŸ”° æ–°ç”¨æˆ·
1. é˜…è¯» **STAGE3_USAGE_GUIDE.md**
2. è¿è¡Œ `./demo_stage3.sh` ä½“éªŒåŠŸèƒ½
3. ä½¿ç”¨æ ‡å‡†QEMUå‘½ä»¤å¯åŠ¨

### ğŸ”§ å¼€å‘è€…  
1. é˜…è¯» **STAGE3_DEVELOPER_GUIDE.md**
2. ç†è§£æ¨¡å—åŒ–æ¶æ„è®¾è®¡
3. è¿è¡Œ `./test/test_stage3_simple.sh` éªŒè¯

### ğŸ› æ•…éšœæ’é™¤
1. æ£€æŸ¥ **STAGE3_COMPLETION_REPORT.md** äº†è§£å·²çŸ¥é™åˆ¶
2. å¯ç”¨è°ƒè¯•æ¨¡å¼: `BOOT_DEBUG=1`
3. æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯è¾“å‡ºå’Œè¯Šæ–­ä¿¡æ¯

---

## ğŸ“ æ”¯æŒ

**é¡¹ç›®çŠ¶æ€**: ğŸ‰ Stage 3 å®Œå…¨å®ç°
**æŠ€æœ¯æ”¯æŒ**: æ‰€æœ‰åŠŸèƒ½å·²éªŒè¯å¹¶æ–‡æ¡£åŒ–
**ä¸‹ä¸€é‡Œç¨‹ç¢‘**: Stage 3.4 - Complete System Validation

**ç‰¹åˆ«æ„Ÿè°¢**: åŸºäºMIT xv6æ“ä½œç³»ç»Ÿé¡¹ç›®çš„ç°ä»£åŒ–å¢å¼ºå®ç°
